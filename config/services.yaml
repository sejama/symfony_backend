# yaml-language-server: $schema=../vendor/symfony/dependency-injection/Loader/schema/services.schema.json

# This file is the entry point to configure your own services.
# Files in the packages/ subdirectory configure your dependencies.
# See also https://symfony.com/doc/current/service_container/import.html

# Put parameters here that don't need to change on each machine where the app is deployed
# https://symfony.com/doc/current/best_practices.html#use-parameters-for-application-configuration
parameters:
    # Configuración de Rate Limiting para Email
    email.rate_limit.per_minute: 2
    email.rate_limit.per_hour: 10
    email.rate_limit.per_day: 50
    
    # Configuración de Seguridad de Email
    email.security.max_body_length: 10000
    email.security.max_recipients: 5
    # email.security.allowed_domains: ['ejemplo.com', 'midominio.com']  # Descomentar para habilitar whitelist
    email.security.allowed_domains: []  # Vacío = todos los dominios permitidos

services:
    # default configuration for services in *this* file
    _defaults:
        autowire: true      # Automatically injects dependencies in your services.
        autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.

    # makes classes in src/ available to be used as services
    # this creates a service per class whose id is the fully-qualified class name
    App\:
        resource: '../src/'
    
    # Configuración del servicio de Rate Limiting
    App\Service\EmailRateLimiter:
        arguments:
            $cacheDir: '%kernel.cache_dir%/email_rate_limiter'
            $maxEmailsPerMinute: '%email.rate_limit.per_minute%'
            $maxEmailsPerHour: '%email.rate_limit.per_hour%'
            $maxEmailsPerDay: '%email.rate_limit.per_day%'
    
    # Configuración del servicio de Validación de Seguridad
    App\Service\EmailSecurityValidator:
        arguments:
            $allowedDomains: '%email.security.allowed_domains%'
            $maxBodyLength: '%email.security.max_body_length%'
            $maxRecipients: '%email.security.max_recipients%'
